(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e():typeof define==="function"&&define.amd?define(e):(t=typeof globalThis!=="undefined"?globalThis:t||self,t.IdleHands=e())})(this,function(){"use strict";class i{constructor(t){if(!t["logoutUrl"]){throw new TypeError("logoutUrl must be defined")}this.applicationId=window.location.hostname;this.cancelButtonText="Stay Logged In";this.containerSelector="body";this.containerTitle="Session Expiration Warning Prompt";this.debug=false;this.dialogText="Your session will expire in %time seconds due to inactivity.";this.dialogTextAllowHtml=false;this.documentTitle="Session Expiration Warning";this.duration=30*1e3;this.events=["click","keypress","scroll","wheel","mousewheel"];this.headerText="Session Expiration Warning";this.heartbeatInterval=60*1e3;this.heartbeatUrl=window.location.href;this.logoutButtonText="Log Out Now";this.logoutDocumentTitle="Logging out...";this.logoutText="Logging out...";this.maximumIdleDuration=60*1e3*60;this.shiftFocus=true;this.zIndex=9999;for(const e in t){this[e]=t[e]}this.manualLogoutUrl=this.logoutUrl}}class n{constructor(t){if(!t)throw new TypeError("applicationId must be defined");this.applicationId=t}log(t){console.log(`[IDLE HANDS - ${this.applicationId}] ${t}`)}}class o{prefix;constructor(t){if(!t)throw new TypeError("applicationId must be defined");this.prefix=t+"_"}set(t,e){localStorage.setItem(this.prefix+t,e)}get(t){return localStorage.getItem(this.prefix+t)}delete(t){localStorage.removeItem(this.prefix+t)}}class t{constructor(t,e=()=>{}){if(!t)throw new TypeError("storage must be defined");this.storage=t;this.setStartTime();this.tickInterval=setInterval(e,1e3)}getCurrentTime(){return(new Date).getTime()}setStartTime(){this.storage.set("startTime",this.getCurrentTime())}getStartTime(){return this.storage.get("startTime")}clearStartTime(){this.storage.delete("startTime")}getIdleTime(){const t=this.getCurrentTime()-this.getStartTime();return t-t%1e3}atInterval(t){return this.getIdleTime()%t===0}getTimeRemaining(t){return t-this.getIdleTime()}stop(){clearInterval(this.tickInterval)}}class s{constructor(t){this.url=t}beat(){fetch(this.url)}}class e{element;create(t,e=[],i={},n="",o=[],s=false){const r=document.createElement(t);e.forEach(function(t){r.classList.add(t)});for(const l in i){r.style.setProperty(l,i[l],"important")}if(s){r.innerHTML=n}else{r.innerText=n}o.forEach(function(t){r.appendChild(t)});return r}}class a extends e{constructor(t){super();this.element=this.create("button",[],{},t)}}class r extends e{constructor(t="",e=[],i={},n=false){super();this.element=this.create("span",[],i,t,e,n)}}class c extends r{constructor(t){super(t,[],{display:"block","font-size":"1.15em","font-weight":"bold",color:"#fff","text-align":"center","background-color":"#1d4289",padding:"8px","font-family":"sans-serif"})}}class l extends e{constructor(t,e={}){super();this.element=this.create("div",[],e,"",t)}}class h extends l{header;textContainer;buttonContainer;constructor(t,e,i){const n=[t.element,e.element,i.element];const o={position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)","min-width":"400px","padding-bottom":"8px","background-color":"white",color:"#152b22"};super(n,o);this.header=t;this.textContainer=e;this.buttonContainer=i}}class g extends l{dialog;constructor(t,e){super([t.element],{position:"fixed",height:"100%",width:"100%",top:"0",left:"0","background-image":'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNksAcAAEUAQRtOwGEAAAAASUVORK5CYII=")',"z-index":e});this.dialog=t}}class u extends l{cancelButton;logoutButton;constructor(t,e){super([t.element,e.element],{display:"flex","justify-content":"space-evenly"});this.cancelButton=t;this.logoutButton=e}}class d extends l{dialogText;constructor(t){super([t.element],{margin:"1em 0.5em","line-height":"1.5"});this.dialogText=t}}class m{static create(t,e,i,n,o){const s=new a(i);const r=new a(n);const l=new h(new c(t),new d(e),new u(s,r));return new g(l,o)}}class p extends e{constructor(){super();this.element=this.create("iframe",[],{display:"none",position:"absolute",top:"0",left:"0",height:"100vh",width:"100vw",border:"none"})}}class f extends p{prompt;isDisplayed;constructor(t,e){super();this.element.title=t;this.prompt=e;this.isDisplayed=false}display(){this.element.style.display="block";this.isDisplayed="true"}hide(){this.element.style.display="none";this.isDisplayed=false}}class T extends r{time;renderedText;constructor(t,e,i){const n=t.split("%time");if(n.length>2){throw new SyntaxError('dialogText must contain no more than one "%time" placeholder')}let o;if(n.length===2){o=n[0]+e+n[1]}else{o=t}super(o,[],{},i);this.time=e;this.renderedText=o}}class x{config;originalDocumentTitle;logger;storage;timer;heartbeat;resetHandler;logoutHandler;container;parent;originalActiveElement;constructor(t={}){this.config=new i(t);const e=this.config.applicationId;this.logger=new n(e);this.storage=new o(e);this.timer=this.createTimer();this.heartbeat=new s(this.config.heartbeatUrl);this.resetHandler=this.reset.bind(this);this.logoutHandler=this.logOut.bind(this);this.originalDocumentTitle=document.title;this.originalActiveElement=document.activeElement||document.body;this.parent=document.querySelector(this.config.containerSelector);this.storage.set("logoutUrl",this.config.logoutUrl);this.setContainerElement();this.setDocumentEventListeners();this.setCancelButtonEventListener();this.setLogoutButtonEventListener()}setContainerElement(){this.container=new f(this.config.containerTitle,this.createPromptElement());this.parent.appendChild(this.container.element);this.container.element.contentWindow.document.body.appendChild(this.container.prompt.element);this.container.element.contentWindow.document.body.style.fontSize=window.getComputedStyle(document.body,null).getPropertyValue("font-size")}createPromptElement(){return m.create(this.config.headerText,this.createDialogText(),this.config.cancelButtonText,this.config.logoutButtonText,this.config.zIndex)}createDialogText(){return new T(this.config.dialogText,this.timer.getTimeRemaining(this.config.maximumIdleDuration)/1e3,this.config.dialogTextAllowHtml)}displayLogoutMessage(){this.container.prompt.dialog.header.element.innerText=this.config.logoutText;this.container.prompt.dialog.buttonContainer.cancelButton.element.disabled=true;this.container.prompt.dialog.buttonContainer.logoutButton.element.disabled=true}hideContainer(){this.log("Hiding container...");this.container.hide();this.log("Removing focus from container...");this.container.element.blur();this.log("Returning focus to original active element...");this.originalActiveElement.focus()}setDocumentEventListeners(){this.config.events.forEach(function(t){this.log(`Setting ${t} event listener on document`);document.addEventListener(t,this.resetHandler)}.bind(this))}unsetDocumentEventListeners(){this.config.events.forEach(function(t){this.log(`Removing ${t} event listener from document`);document.removeEventListener(t,this.resetHandler)}.bind(this))}setCancelButtonEventListener(){this.container.prompt.dialog.buttonContainer.cancelButton.element.addEventListener("click",this.resetHandler)}setLogoutButtonEventListener(){this.container.prompt.dialog.buttonContainer.logoutButton.element.addEventListener("click",function(){this.storage.set("logoutUrl",this.config.manualLogoutUrl);this.logoutHandler()}.bind(this))}createTimer(){return new t(this.storage,this.tick.bind(this))}log(t){if(this.config.debug)this.logger.log(t)}reset(){this.log("Reverting document title...");document.title=this.originalDocumentTitle;this.setDocumentEventListeners();this.hideContainer();this.log("Stopping timer...");this.timer.stop();this.log("Assigning new timer...");this.timer=this.createTimer()}logOut(){this.log("Updating document title...");document.title=this.config.logoutDocumentTitle;this.log("Stopping timer...");this.timer.stop();this.log("Clearing start time...");this.timer.clearStartTime();this.log("Displaying logout message...");this.displayLogoutMessage();this.log("Redirecting to logout URL...");window.location.replace(this.storage.get("logoutUrl"))}tick(){const t=this.timer;const e=this.config["heartbeatInterval"];const i=this.config.maximumIdleDuration;const n=t.getTimeRemaining(i);const o=this.config.duration;const s=this.container.isDisplayed;const r=this.createDialogText(n/1e3).element.innerHTML;this.log("Tick...");if(n<0){this.log("Logging out...");this.logoutHandler();return}this.log("Updating prompt...");this.container.prompt.dialog.textContainer.dialogText.element.innerHTML=r;if(n>o&&s){this.log("Updating document title...");document.title=this.originalDocumentTitle;this.hideContainer()}if(n<=o&&!s){this.log("Updating document title...");document.title=this.config.documentTitle;this.log("Unsetting event listeners...");this.unsetDocumentEventListeners();this.log("Displaying prompt...");this.container.display();if(this.config.shiftFocus){this.log("Shifting focus to cancel button...");this.container.prompt.dialog.buttonContainer.cancelButton.element.focus()}}if(n<=0){this.log("Logging out...");this.logOut()}else if(t.atInterval(e)){this.log("Heartbeat...");this.heartbeat.beat()}}}return x});